# MAILING

**API** с возможностью отслеживания почтовых отправлений.

# Stack

![](https://img.shields.io/badge/Java-✓-blue.svg)
![](https://img.shields.io/badge/Spring_Boot-✓-blue.svg)
![](https://img.shields.io/badge/PostgreSQL-✓-blue.svg)
![](https://img.shields.io/badge/JPA-✓-blue.svg)

***
Для запуска приложения необходимо скачать архив, распаковать его, и импортировать и IDE.

После запуска приложения в IDE, к использованию будут доступны следующие возможности:

- Добавление почтового отделения
- Просмотр информации об активном почтовом отделении
- Получение списка активных почтовых отделений
- Удаление почтового отделения (пометка на удаление)
- Просмотр списка почтовых отделений, помеченных на удаление
- Регистрация почтового отправления
- Отправка почтового отправления
- Отслеживание статуса почтового отправления
- Прибытие почтового отправления в промежуточное почтовое отделение
- Доставка почтового отправления получателю
- Просмотр истории движения почтового отправления
- Просмотр списка актуальных почтовых отправлений
- Просмотр архива почтовых отправлений
- Просмотр списка всех почтовых отправлений, в том числе, архивных
- Просмотр почтового отправления по его идентификатору

***

**Типы почтовых отправлений, и их используемые аббревиатуры в запросах:**

    Письмо - LETTER,
    Посылка - PARCEL,
    Бандероль - WRAPPER,
    Открытка - POSTCARD

***
**Статусы почтовых отправлений, и их используемые аббревиатуры:**

    Почтовое отправление зарегистрировано в почтовом отделение - REGISTERED,
    Почтовое отправление в пути, выбыло из почтового отделения - ON_ROUTE,
    Почтовое отправление прибыло в промежуточное почтовое отделение - POINT,
    Почтовое отправление передано курьеру, осуществляющему доставку - COURIER,
    Почтовое отправление доставлено получателю - DELIVERED

***
<h1>Запросы, принимаемые API и возвращаемые им ответы:</h1>

<h2>/add/office</h2>

* Добавление почтового отделения
* Пример запроса: http://localhost:8080/add/office
* Тип запроса **POST**
* Пример тела запроса:
```json
{
  "postalCode": "309503",
  "name": "Старый Оскол 17",
  "address": "Белгородская область"
}
```

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * В случае, если записи не существовало ранее, она будет создана, в случае, если 
      запись существовала ранее, в логах приложения будет выведено 
      сообщение "Postal Office 309503 already created!".
    * Тело ответа отсутствует.

<h2>office/{postalOffice}</h2>

* Просмотр информации об активном почтовом отделении
* Пример запроса: http://localhost:8080/office/309503
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * Почтовое отделение найдено и не помечено на удаление
    * Тело ответа
```json
{
  "postalCode": "309503",
  "name": "Старый Оскол 17",
  "address": "Белгородская область",
  "deleted": false
}
```
* Статус ответа:
    * 404
    * Почтовое отделение не найдено, либо помечено на удаление.
    * Тело ответа отсутствует.

<h2>/offices</h2>

* Получение списка активных почтовых отделений
* Пример запроса: http://localhost:8080/offices
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * Найдены не помеченные на удаление почтовые отделения
    * Тело ответа
```json
[
  {
    "postalCode": "309502",
    "name": "Старый Оскол 16",
    "address": "Белгородская область",
    "deleted": false
  },
  {
    "postalCode": "309503",
    "name": "Старый Оскол 17",
    "address": "Белгородская область",
    "deleted": false
  }
]
```

<h2>/offices</h2>

* Удаление почтового отделения (пометка на удаление)
* Пример запроса: http://localhost:8080/offices
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * Почтовое отделение удалено, в логах приложения будет выведено сообщение
      "Postal Office 309503 deleted!".
    * Тело ответа отсутствует.

<h2>/deleted/offices</h2>

* Получение списка помеченных на удаление почтовых отделений
* Пример запроса: localhost:8080/deleted/offices
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * Найдены помеченные на удаление почтовые отделения
    * Тело ответа
```json
[
  {
    "postalCode": "309503",
    "name": "Старый Оскол 17",
    "address": "Белгородская область",
    "deleted": true
  }
]
```

<h2>/add/office</h2>

* Добавление почтового отделения
* Пример запроса: http://localhost:8080/add/office
* Тип запроса **POST**
* Пример тела запроса:
```json
{
  "postalCode": "309503",
  "name": "Старый Оскол 17",
  "address": "Белгородская область"
}
```

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * В случае, если записи не существовало ранее, она будет создана, в случае, если
      запись существовала ранее, в логах приложения будет выведено
      сообщение "Postal Office 309503 already created!".
    * Тело ответа отсутствует.

<h2>/create</h2>

* Регистрация почтового отправления
* Пример запроса: http://localhost:8090/create
* Тип запроса **POST**
* Пример тела запроса:
```json
{
  "postalItem": {
    "postalType": "LETTER",
    "receiverPostalCode": {
      "postalCode": "309503"
    },
    "receiverAddress": "Белгородская область, г Старый Оскол",
    "receiverName": "Иванов Иван Иванович"
  },
  "registrationOffice": {
    "postalCode": "309502"
  },
  "destinationOffice": {
    "postalCode": "309503"
  }
}
```

**Варианты ответов сервера:**

* Статус ответа:
    * 200
    * Почтовое зарегистрировано
    * Тело ответа отсутствует.
  
* Статус ответа:
    * 403
    * Почтовое отделение не найдено, либо помечено на удаление.
    * Тело ответа отсутствует.


<h2>/sending/{postItem}</h2>

* Отправка почтового отправления
* Пример запроса: http://localhost:8090/sending/1000000013
* Тип запроса **POST**
* Тело запроса отсутствует.

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Почтовое отправление отправлено
  * Тело ответа отсутствует.

* Статус ответа:
  * 404
  * Почтовое отправление не найдено.
  * Тело ответа отсутствует.

* Статус ответа:
  * 409
  * Почтовое отправление уже покинуло почтовое отделение.
  * Тело ответа отсутствует.

<h2>/status/{postItem}</h2>

* Проверка статуса почтового отправления
* Пример запроса: localhost:8080/status/1000000013
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Статус почтового отправления получен
  * Тело ответа
```string
"ON_ROUTE"
```

* Статус ответа:
  * 404
  * Почтовое отправление не найдено.
  * Тело ответа отсутствует.


<h2>/point/{postItem}</h2>

* Прохождение почтовым отправлением контрольной точки: поступление в промежуточное отделение,
  передача курьеру для доставки, доставка адресату.
* Пример запроса: localhost:8080/point/1000000013
* Тип запроса **POST**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * В случае, если статус почтового отправления был "ON_ROUTE", он будет изменён на "POINT"
  * В случае, если статус почтового отправления был "POINT", он будет изменён на "COURIER"
  * В случае, если статус почтового отправления был "COURIER", он будет изменён на "DELIVERED"
  * Тело ответа отсутствует.

* Статус ответа:
  * 404
  * Почтовое отправление не найдено, либо уже было доставлено адресату.
  * Тело ответа отсутствует.


<h2>/history/{postItem}</h2>

* Просмотр истории движения почтового отправления.
* Пример запроса: localhost:8080/history/1000000013
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * В случае, если статус почтового отправления был "ON_ROUTE", он будет изменён на "POINT"
  * В случае, если статус почтового отправления был "POINT", он будет изменён на "COURIER"
  * В случае, если статус почтового отправления был "COURIER", он будет изменён на "DELIVERED"
  * Тело ответа:
```json
{
  "number": "1000000013",
  "currentStatus": "DELIVERED",
  "events": [
    {
      "date": "2021-04-30 18:04:27.021",
      "event": "309502 / REGISTERED"
    },
    {
      "date": "2021-04-30 18:08:25.866",
      "event": "309502 / ON_ROUTE"
    },
    {
      "date": "2021-04-30 18:14:29.763",
      "event": "309503 / POINT"
    },
    {
      "date": "2021-04-30 18:16:24.532",
      "event": "309503 / COURIER"
    },
    {
      "date": "2021-04-30 18:16:36.929",
      "event": "309503 / DELIVERED"
    }
  ]
}
```

* Статус ответа:
  * 404
  * Почтовое отправление не найдено.
  * Тело ответа отсутствует.


<h2>/item/actual</h2>

* Просмотр списка актуальных почтовых отправлений
* Пример запроса: localhost:8080/item/actual
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Найдены почтовые отправления, статус которых не "DELIVERED"
  * Тело ответа
```json
[
  {
    "id": 1000000012,
    "deleted": false,
    "postalType": "LETTER",
    "receiverPostalCode": {
      "postalCode": "309503",
      "name": "Старый Оскол 18",
      "address": "Белгородская область",
      "deleted": false
    },
    "receiverAddress": "Белгородская область, г Старый Оскол",
    "receiverName": "Васильев Иван Иванович"
  }
]
```


<h2>/item/archive</h2>

* Просмотр архива почтовых отправлений
* Пример запроса: localhost:8080/item/archive
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Найдены почтовые отправления, статус которых "DELIVERED"
  * Тело ответа
```json
[
  {
    "id": 1000000013,
    "deleted": true,
    "postalType": "LETTER",
    "receiverPostalCode": {
      "postalCode": "309503",
      "name": "Старый Оскол 18",
      "address": "Белгородская область",
      "deleted": false
    },
    "receiverAddress": "Белгородская область, г Старый Оскол",
    "receiverName": "Иванов Иван Иванович"
  }
]
```


<h2>/item/getAll</h2>

* Получение списка всех почтовых отправлений
* Пример запроса: http://localhost:8080/item/getAll
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Найдены почтовые отправления, в любом статусе
  * Тело ответа
```json
[
  {
    "id": 1000000012,
    "deleted": false,
    "postalType": "LETTER",
    "receiverPostalCode": {
      "postalCode": "309503",
      "name": "Старый Оскол 18",
      "address": "Белгородская область",
      "deleted": false
    },
    "receiverAddress": "Белгородская область, г Старый Оскол",
    "receiverName": "Васильев Иван Иванович"
  },
  {
    "id": 1000000013,
    "deleted": true,
    "postalType": "LETTER",
    "receiverPostalCode": {
      "postalCode": "309503",
      "name": "Старый Оскол 18",
      "address": "Белгородская область",
      "deleted": false
    },
    "receiverAddress": "Белгородская область, г Старый Оскол",
    "receiverName": "Иванов Иван Иванович"
  }
]
```

<h2>/item/{postItem}</h2>

* Просмотр информации о почтовом отправлении по его идентификатору
* Пример запроса: localhost:8080/item/1000000013
* Тип запроса **GET**
* Тело запроса отсутствует:

**Варианты ответов сервера:**

* Статус ответа:
  * 200
  * Статус почтового отправления получен
  * Тело ответа
```json
{
  "id": 1000000013,
  "deleted": true,
  "postalType": "LETTER",
  "receiverPostalCode": {
    "postalCode": "309503",
    "name": "Старый Оскол 18",
    "address": "Белгородская область",
    "deleted": false
  },
  "receiverAddress": "Белгородская область, г Старый Оскол",
  "receiverName": "Иванов Иван Иванович"
}
```

* Статус ответа:
  * 404
  * Почтовое отправление не найдено.
  * Тело ответа отсутствует.



***
<h1>Блок в доработке</h1>

Для запуска приложения, необходимо наличие на компьютере, 
сервера приложений, например, Tomcat Server.

Если на вашем компьютере нет сервера приложений, последнюю актуальную 
версию сервера приложений Tomcat можно скачать по ссылке: 
https://mirror.linux-ia64.org/apache/tomcat/tomcat-10/v10.0.5/bin/apache-tomcat-10.0.5.zip

Полученный архив необходимо распаковать в любую директорию, например, "C:\tools\", после чего,
в директории "webapps" распакованной директории, необходимо поместить, скомпилированный
ранее war-file, с архивом приложения. Для удобства, его можно переименовать, например
в "mailing.war".

Далее, в директории bin сервера Tomcat, либо на файле startapp.bat, вызвав контекстное меню,
выбрать команду выполнить, либо в командной строке, выполнить команду startapp.bat. 
Произойдёт запуск сервера приложений, а само приложение, будет доступно 
по адресу: localhost:8080/mailing